
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Concurrence · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="performance.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../installation/">
            
                <a href="../installation/">
            
                    
                    Installation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../installation/on_debian_and_ubuntu.html">
            
                <a href="../installation/on_debian_and_ubuntu.html">
            
                    
                    Sur Debian et Ubuntu
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../installation/on_redhat_and_centos.html">
            
                <a href="../installation/on_redhat_and_centos.html">
            
                    
                    Sur RedHat et CentOS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../installation/on_arch_linux.html">
            
                <a href="../installation/on_arch_linux.html">
            
                    
                    Sur Arch Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../installation/on_gentoo_linux.html">
            
                <a href="../installation/on_gentoo_linux.html">
            
                    
                    Sur Gentoo Linux
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../installation/on_bash_on_ubuntu_on_windows.html">
            
                <a href="../installation/on_bash_on_ubuntu_on_windows.html">
            
                    
                    Sur Bash sur Ubuntu sur Windows
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../installation/on_mac_osx_using_homebrew.html">
            
                <a href="../installation/on_mac_osx_using_homebrew.html">
            
                    
                    Sur Mac OSX avec Homebrew
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../installation/from_a_targz.html">
            
                <a href="../installation/from_a_targz.html">
            
                    
                    Depuis un tar.gz
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../installation/from_source_repository.html">
            
                <a href="../installation/from_source_repository.html">
            
                    
                    Depuis les sources
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../using_the_compiler/">
            
                <a href="../using_the_compiler/">
            
                    
                    Utiliser le compilateur
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../overview/">
            
                <a href="../overview/">
            
                    
                    Aperçu et exemples
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../overview/hello_world.html">
            
                <a href="../overview/hello_world.html">
            
                    
                    Hello World!
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../overview/http_server.html">
            
                <a href="../overview/http_server.html">
            
                    
                    Serveur HTTP
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../syntax_and_semantics/">
            
                <a href="../syntax_and_semantics/">
            
                    
                    Syntaxe et sémantique
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../syntax_and_semantics/comments.html">
            
                <a href="../syntax_and_semantics/comments.html">
            
                    
                    Commentaires
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../syntax_and_semantics/literals.html">
            
                <a href="../syntax_and_semantics/literals.html">
            
                    
                    Littéraux
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.2.1" data-path="../syntax_and_semantics/literals/nil.html">
            
                <a href="../syntax_and_semantics/literals/nil.html">
            
                    
                    Nil
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.2" data-path="../syntax_and_semantics/literals/bool.html">
            
                <a href="../syntax_and_semantics/literals/bool.html">
            
                    
                    Bool
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.3" data-path="../syntax_and_semantics/literals/integers.html">
            
                <a href="../syntax_and_semantics/literals/integers.html">
            
                    
                    Int
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.4" data-path="../syntax_and_semantics/literals/floats.html">
            
                <a href="../syntax_and_semantics/literals/floats.html">
            
                    
                    Float
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.5" data-path="../syntax_and_semantics/literals/char.html">
            
                <a href="../syntax_and_semantics/literals/char.html">
            
                    
                    Char
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.6" data-path="../syntax_and_semantics/literals/string.html">
            
                <a href="../syntax_and_semantics/literals/string.html">
            
                    
                    String
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.7" data-path="../syntax_and_semantics/literals/symbol.html">
            
                <a href="../syntax_and_semantics/literals/symbol.html">
            
                    
                    Symbol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.8" data-path="../syntax_and_semantics/literals/array.html">
            
                <a href="../syntax_and_semantics/literals/array.html">
            
                    
                    Array
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.9" data-path="../syntax_and_semantics/literals/hash.html">
            
                <a href="../syntax_and_semantics/literals/hash.html">
            
                    
                    Hash
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.10" data-path="../syntax_and_semantics/literals/range.html">
            
                <a href="../syntax_and_semantics/literals/range.html">
            
                    
                    Range
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.11" data-path="../syntax_and_semantics/literals/regex.html">
            
                <a href="../syntax_and_semantics/literals/regex.html">
            
                    
                    Regex
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.12" data-path="../syntax_and_semantics/literals/tuple.html">
            
                <a href="../syntax_and_semantics/literals/tuple.html">
            
                    
                    Tuple
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.13" data-path="../syntax_and_semantics/literals/named_tuple.html">
            
                <a href="../syntax_and_semantics/literals/named_tuple.html">
            
                    
                    NamedTuple
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2.14" data-path="../syntax_and_semantics/literals/proc.html">
            
                <a href="../syntax_and_semantics/literals/proc.html">
            
                    
                    Proc
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../syntax_and_semantics/assignment.html">
            
                <a href="../syntax_and_semantics/assignment.html">
            
                    
                    Affectation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.3.1" data-path="../syntax_and_semantics/multiple_assignment.html">
            
                <a href="../syntax_and_semantics/multiple_assignment.html">
            
                    
                    Affectations multiples
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../syntax_and_semantics/local_variables.html">
            
                <a href="../syntax_and_semantics/local_variables.html">
            
                    
                    Variables locales
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../syntax_and_semantics/union_types.html">
            
                <a href="../syntax_and_semantics/union_types.html">
            
                    
                    Types union
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../syntax_and_semantics/control_expressions.html">
            
                <a href="../syntax_and_semantics/control_expressions.html">
            
                    
                    Structures de contrôle
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.6.1" data-path="../syntax_and_semantics/truthy_and_falsey_values.html">
            
                <a href="../syntax_and_semantics/truthy_and_falsey_values.html">
            
                    
                    Valeurs vraies et fausses
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.2" data-path="../syntax_and_semantics/if.html">
            
                <a href="../syntax_and_semantics/if.html">
            
                    
                    if
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.6.2.1" data-path="../syntax_and_semantics/as_a_suffix.html">
            
                <a href="../syntax_and_semantics/as_a_suffix.html">
            
                    
                    Comme suffixe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.2.2" data-path="../syntax_and_semantics/as_an_expression.html">
            
                <a href="../syntax_and_semantics/as_an_expression.html">
            
                    
                    Comme expression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.2.3" data-path="../syntax_and_semantics/ternary_if.html">
            
                <a href="../syntax_and_semantics/ternary_if.html">
            
                    
                    if ternaire
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.2.4" data-path="../syntax_and_semantics/if_var.html">
            
                <a href="../syntax_and_semantics/if_var.html">
            
                    
                    if var
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.2.5" data-path="../syntax_and_semantics/if_varis_a.html">
            
                <a href="../syntax_and_semantics/if_varis_a.html">
            
                    
                    if var.is_a?(...)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.2.6" data-path="../syntax_and_semantics/if_varresponds_to.html">
            
                <a href="../syntax_and_semantics/if_varresponds_to.html">
            
                    
                    if var.responds_to?(...)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.2.7" data-path="../syntax_and_semantics/if_var_nil.html">
            
                <a href="../syntax_and_semantics/if_var_nil.html">
            
                    
                    if var.nil?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.2.8" data-path="../syntax_and_semantics/not.html">
            
                <a href="../syntax_and_semantics/not.html">
            
                    
                    if !
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.6.3" data-path="../syntax_and_semantics/unless.html">
            
                <a href="../syntax_and_semantics/unless.html">
            
                    
                    unless
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.4" data-path="../syntax_and_semantics/case.html">
            
                <a href="../syntax_and_semantics/case.html">
            
                    
                    case
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.5" data-path="../syntax_and_semantics/while.html">
            
                <a href="../syntax_and_semantics/while.html">
            
                    
                    while
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.6.5.1" data-path="../syntax_and_semantics/break.html">
            
                <a href="../syntax_and_semantics/break.html">
            
                    
                    break
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.5.2" data-path="../syntax_and_semantics/next.html">
            
                <a href="../syntax_and_semantics/next.html">
            
                    
                    next
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.6.6" data-path="../syntax_and_semantics/until.html">
            
                <a href="../syntax_and_semantics/until.html">
            
                    
                    until
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.7" data-path="../syntax_and_semantics/and.html">
            
                <a href="../syntax_and_semantics/and.html">
            
                    
                    &&
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6.8" data-path="../syntax_and_semantics/or.html">
            
                <a href="../syntax_and_semantics/or.html">
            
                    
                    ||
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../syntax_and_semantics/types_and_methods.html">
            
                <a href="../syntax_and_semantics/types_and_methods.html">
            
                    
                    Types et méthodes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.7.1" data-path="../syntax_and_semantics/everything_is_an_object.html">
            
                <a href="../syntax_and_semantics/everything_is_an_object.html">
            
                    
                    Tout est objet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.2" data-path="../syntax_and_semantics/the_program.html">
            
                <a href="../syntax_and_semantics/the_program.html">
            
                    
                    Le Programme
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.3" data-path="../syntax_and_semantics/classes_and_methods.html">
            
                <a href="../syntax_and_semantics/classes_and_methods.html">
            
                    
                    Classes et méthodes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.7.3.1" data-path="../syntax_and_semantics/new,_initialize_and_allocate.html">
            
                <a href="../syntax_and_semantics/new,_initialize_and_allocate.html">
            
                    
                    new, initialize et allocate
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.3.2" data-path="../syntax_and_semantics/methods_and_instance_variables.html">
            
                <a href="../syntax_and_semantics/methods_and_instance_variables.html">
            
                    
                    Méthodes et variables d'instance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.3.3" data-path="../syntax_and_semantics/type_inference.html">
            
                <a href="../syntax_and_semantics/type_inference.html">
            
                    
                    Inférence de type
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.3.4" data-path="../syntax_and_semantics/overloading.html">
            
                <a href="../syntax_and_semantics/overloading.html">
            
                    
                    Surcharge
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.3.5" data-path="../syntax_and_semantics/default_and_named_arguments.html">
            
                <a href="../syntax_and_semantics/default_and_named_arguments.html">
            
                    
                    Valeurs par défaut et arguments nommés
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.3.6" data-path="../syntax_and_semantics/splats_and_tuples.html">
            
                <a href="../syntax_and_semantics/splats_and_tuples.html">
            
                    
                    Splats et tuples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.3.7" data-path="../syntax_and_semantics/type_restrictions.html">
            
                <a href="../syntax_and_semantics/type_restrictions.html">
            
                    
                    Restrictions de type
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.3.8" data-path="../syntax_and_semantics/return_types.html">
            
                <a href="../syntax_and_semantics/return_types.html">
            
                    
                    Types de retour
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.3.9" data-path="../syntax_and_semantics/default_values_named_arguments_splats_tuples_and_overloading.html">
            
                <a href="../syntax_and_semantics/default_values_named_arguments_splats_tuples_and_overloading.html">
            
                    
                    Arguments de méthode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.3.10" data-path="../syntax_and_semantics/operators.html">
            
                <a href="../syntax_and_semantics/operators.html">
            
                    
                    Opérateurs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.3.11" data-path="../syntax_and_semantics/visibility.html">
            
                <a href="../syntax_and_semantics/visibility.html">
            
                    
                    Visibilité
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.3.12" data-path="../syntax_and_semantics/inheritance.html">
            
                <a href="../syntax_and_semantics/inheritance.html">
            
                    
                    Héritage
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.7.3.12.1" data-path="../syntax_and_semantics/virtual_and_abstract_types.html">
            
                <a href="../syntax_and_semantics/virtual_and_abstract_types.html">
            
                    
                    Types virtuels et abstraits
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.7.3.13" data-path="../syntax_and_semantics/class_variables.html">
            
                <a href="../syntax_and_semantics/class_variables.html">
            
                    
                    Variables de classe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.3.14" data-path="../syntax_and_semantics/finalize.html">
            
                <a href="../syntax_and_semantics/finalize.html">
            
                    
                    finalize
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.7.4" data-path="../syntax_and_semantics/modules.html">
            
                <a href="../syntax_and_semantics/modules.html">
            
                    
                    Modules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.5" data-path="../syntax_and_semantics/generics.html">
            
                <a href="../syntax_and_semantics/generics.html">
            
                    
                    Génériques
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.6" data-path="../syntax_and_semantics/structs.html">
            
                <a href="../syntax_and_semantics/structs.html">
            
                    
                    Structs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.7" data-path="../syntax_and_semantics/constants.html">
            
                <a href="../syntax_and_semantics/constants.html">
            
                    
                    Constantes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.8" data-path="../syntax_and_semantics/enum.html">
            
                <a href="../syntax_and_semantics/enum.html">
            
                    
                    Enums
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.9" data-path="../syntax_and_semantics/blocks_and_procs.html">
            
                <a href="../syntax_and_semantics/blocks_and_procs.html">
            
                    
                    Blocs et Procs
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.7.9.1" data-path="../syntax_and_semantics/capturing_blocks.html">
            
                <a href="../syntax_and_semantics/capturing_blocks.html">
            
                    
                    Capture de blocs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.9.2" data-path="../syntax_and_semantics/proc_literal.html">
            
                <a href="../syntax_and_semantics/proc_literal.html">
            
                    
                    Litéral Proc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.9.3" data-path="../syntax_and_semantics/block_forwarding.html">
            
                <a href="../syntax_and_semantics/block_forwarding.html">
            
                    
                    Passage de Bloc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7.9.4" data-path="../syntax_and_semantics/closures.html">
            
                <a href="../syntax_and_semantics/closures.html">
            
                    
                    Fermetures
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.7.10" data-path="../syntax_and_semantics/alias.html">
            
                <a href="../syntax_and_semantics/alias.html">
            
                    
                    Alias
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="../syntax_and_semantics/type_reflection.html">
            
                <a href="../syntax_and_semantics/type_reflection.html">
            
                    
                    Réflexion de type
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.8.1" data-path="../syntax_and_semantics/is_a.html">
            
                <a href="../syntax_and_semantics/is_a.html">
            
                    
                    is_a?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8.2" data-path="../syntax_and_semantics/nil_question.html">
            
                <a href="../syntax_and_semantics/nil_question.html">
            
                    
                    nil?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8.3" data-path="../syntax_and_semantics/responds_to.html">
            
                <a href="../syntax_and_semantics/responds_to.html">
            
                    
                    responds_to?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8.4" data-path="../syntax_and_semantics/as.html">
            
                <a href="../syntax_and_semantics/as.html">
            
                    
                    as
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8.5" data-path="../syntax_and_semantics/as_question.html">
            
                <a href="../syntax_and_semantics/as_question.html">
            
                    
                    as?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8.6" data-path="../syntax_and_semantics/typeof.html">
            
                <a href="../syntax_and_semantics/typeof.html">
            
                    
                    typeof
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="../syntax_and_semantics/attributes.html">
            
                <a href="../syntax_and_semantics/attributes.html">
            
                    
                    Attributs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="../syntax_and_semantics/requiring_files.html">
            
                <a href="../syntax_and_semantics/requiring_files.html">
            
                    
                    Fichiers requis
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="../syntax_and_semantics/low_level_primitives.html">
            
                <a href="../syntax_and_semantics/low_level_primitives.html">
            
                    
                    Primitives bas niveau
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.11.1" data-path="../syntax_and_semantics/pointerof.html">
            
                <a href="../syntax_and_semantics/pointerof.html">
            
                    
                    pointerof
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11.2" data-path="../syntax_and_semantics/sizeof.html">
            
                <a href="../syntax_and_semantics/sizeof.html">
            
                    
                    sizeof
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11.3" data-path="../syntax_and_semantics/instance_sizeof.html">
            
                <a href="../syntax_and_semantics/instance_sizeof.html">
            
                    
                    instance_sizeof
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11.4" data-path="../syntax_and_semantics/declare_var.html">
            
                <a href="../syntax_and_semantics/declare_var.html">
            
                    
                    Déclaration de variable non initialisée
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.12" data-path="../syntax_and_semantics/exception_handling.html">
            
                <a href="../syntax_and_semantics/exception_handling.html">
            
                    
                    Gestion des exceptions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13" data-path="../syntax_and_semantics/compile_time_flags.html">
            
                <a href="../syntax_and_semantics/compile_time_flags.html">
            
                    
                    Compile-time flags
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.13.1" data-path="../syntax_and_semantics/cross-compilation.html">
            
                <a href="../syntax_and_semantics/cross-compilation.html">
            
                    
                    Compilation croisée
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.14" data-path="../syntax_and_semantics/macros.html">
            
                <a href="../syntax_and_semantics/macros.html">
            
                    
                    Macros
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.14.1" data-path="../syntax_and_semantics/macros/macro_methods.html">
            
                <a href="../syntax_and_semantics/macros/macro_methods.html">
            
                    
                    Méthodes de macro
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14.2" data-path="../syntax_and_semantics/macros/hooks.html">
            
                <a href="../syntax_and_semantics/macros/hooks.html">
            
                    
                    Hooks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14.3" data-path="../syntax_and_semantics/macros/fresh_variables.html">
            
                <a href="../syntax_and_semantics/macros/fresh_variables.html">
            
                    
                    Variables fraîches
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.15" data-path="../syntax_and_semantics/c_bindings/">
            
                <a href="../syntax_and_semantics/c_bindings/">
            
                    
                    Liaisons en C
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.15.1" data-path="../syntax_and_semantics/c_bindings/lib.html">
            
                <a href="../syntax_and_semantics/c_bindings/lib.html">
            
                    
                    lib
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.15.2" data-path="../syntax_and_semantics/c_bindings/fun.html">
            
                <a href="../syntax_and_semantics/c_bindings/fun.html">
            
                    
                    fun
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.15.2.1" data-path="../syntax_and_semantics/c_bindings/out.html">
            
                <a href="../syntax_and_semantics/c_bindings/out.html">
            
                    
                    out
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.15.2.2" data-path="../syntax_and_semantics/c_bindings/to_unsafe.html">
            
                <a href="../syntax_and_semantics/c_bindings/to_unsafe.html">
            
                    
                    to_unsafe
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.15.3" data-path="../syntax_and_semantics/c_bindings/struct.html">
            
                <a href="../syntax_and_semantics/c_bindings/struct.html">
            
                    
                    struct
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.15.4" data-path="../syntax_and_semantics/c_bindings/union.html">
            
                <a href="../syntax_and_semantics/c_bindings/union.html">
            
                    
                    union
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.15.5" data-path="../syntax_and_semantics/c_bindings/enum.html">
            
                <a href="../syntax_and_semantics/c_bindings/enum.html">
            
                    
                    enum
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.15.6" data-path="../syntax_and_semantics/c_bindings/variables.html">
            
                <a href="../syntax_and_semantics/c_bindings/variables.html">
            
                    
                    Variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.15.7" data-path="../syntax_and_semantics/c_bindings/constants.html">
            
                <a href="../syntax_and_semantics/c_bindings/constants.html">
            
                    
                    Constantes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.15.8" data-path="../syntax_and_semantics/c_bindings/type.html">
            
                <a href="../syntax_and_semantics/c_bindings/type.html">
            
                    
                    type
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.15.9" data-path="../syntax_and_semantics/c_bindings/alias.html">
            
                <a href="../syntax_and_semantics/c_bindings/alias.html">
            
                    
                    alias
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.15.10" data-path="../syntax_and_semantics/c_bindings/callbacks.html">
            
                <a href="../syntax_and_semantics/c_bindings/callbacks.html">
            
                    
                    Callbacks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5.16" data-path="../syntax_and_semantics/type_grammar.html">
            
                <a href="../syntax_and_semantics/type_grammar.html">
            
                    
                    Grammaire de type
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.17" data-path="../syntax_and_semantics/unsafe.html">
            
                <a href="../syntax_and_semantics/unsafe.html">
            
                    
                    Code dangereux
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../conventions/">
            
                <a href="../conventions/">
            
                    
                    Conventions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../conventions/coding_style.html">
            
                <a href="../conventions/coding_style.html">
            
                    
                    Style de codage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../conventions/documenting_code.html">
            
                <a href="../conventions/documenting_code.html">
            
                    
                    Documenter son code
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="./">
            
                <a href="./">
            
                    
                    Guides
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="performance.html">
            
                <a href="performance.html">
            
                    
                    Performance
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.7.2" data-path="concurrency.html">
            
                <a href="concurrency.html">
            
                    
                    Concurrence
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Concurrence</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="concurrence">Concurrence</h1>
<h2 id="concurrence-vs-parall&#xE9;lisme">Concurrence vs. Parall&#xE9;lisme</h2>
<p>Les notions de &quot;concurrence&quot; et &quot;parall&#xE9;lisme&quot; sont parfois confondues, mais sont diff&#xE9;rentes.</p>
<p>Un syst&#xE8;me concurrent est un syst&#xE8;me en charge de plusieurs t&#xE2;ches, mais qu&apos;il n&apos;ex&#xE9;cute pas forc&#xE9;ment en m&#xEA;me temps.
Imaginez que vous &#xEA;tes en train de faire &#xE0; manger dans la cuisine: vous &#xE9;pluchez un oignon, vous le mettez &#xE0; frire, et alors qu&apos;il est en train de frire
vous &#xE9;pluchez une tomate, mais vous ne faites pas toutes ces choses en m&#xEA;me temps: vous partagez votre temps entre ces diff&#xE9;rentes t&#xE2;ches.
Le parall&#xE9;lisme reviendrait &#xE0; remuer l&apos;oignon en train de cuire d&apos;une main tout en &#xE9;pluchant une tomate de l&apos;autre main.</p>
<p>Alors que vous lisez ces lignes, Crystal supporte la concurrence mais pas le parall&#xE9;lisme:
plusieurs t&#xE2;ches peuvent &#xEA;tre ex&#xE9;cut&#xE9;es, et un peu de temps sera pass&#xE9; sur chacune d&apos;elle, mais deux portions de code ne seront jamais ex&#xE9;cut&#xE9;es exactement en m&#xEA;me temps.</p>
<p>Un programme Crystal s&apos;ex&#xE9;cute dans un seul thread du syst&#xE8;me d&apos;exploitation, except&#xE9; le Ramasse-miettes (Garbage Collector ou GC), qui impl&#xE9;mente un algorithme concurrent &quot;marquant-et-nettoyant&quot; (actuellement <a href="http://www.hboehm.info/gc/" target="_blank">Boehm GC</a>).</p>
<h3 id="fibers">Fibers</h3>
<p>Pour permettre la concurrence, Crystal a les fibers. Une fiber est d&apos;une certaine mani&#xE8;re similaire &#xE0; un thread de syst&#xE8;me d&apos;exploitation
&#xE0; la diff&#xE9;rence qu&apos;elle est beaucoup plus l&#xE9;g&#xE9;re et son ex&#xE9;cution est g&#xE9;r&#xE9;e en interne par le processus.
Ainsi, un programme va lancer plusieurs fibers et Crystal va s&apos;assurer de les ex&#xE9;cuter au bon moment.</p>
<h3 id="boucle-&#xE9;v&#xE9;nementielle">Boucle &#xE9;v&#xE9;nementielle</h3>
<p>Pour tout ce qui est li&#xE9; aux I/O il y a une boucle &#xE9;v&#xE9;nementielle. Certaines op&#xE9;rations prenant du temps lui sont d&#xE9;l&#xE9;gu&#xE9;es,
et pendant que la boucle &#xE9;v&#xE9;nementielle attend apr&#xE8;s la fin de cette op&#xE9;ration, le programme peut continuer &#xE0; ex&#xE9;cuter d&apos;autres fibers.
Un exemple simple de cela est lors de l&apos;attente de la r&#xE9;ception de donn&#xE9;es depuis une socket.</p>
<h3 id="canaux">Canaux</h3>
<p>Crystal a des canaux (Channels) inspir&#xE9;s de <a href="https://fr.wikipedia.org/wiki/Communicating_sequential_processes" target="_blank">CSP</a>.
Ils permettent de communiquer des donn&#xE9;es entre des fibers sans partage de m&#xE9;moire et sans se soucier des verrous, s&#xE9;maphores et autres structures sp&#xE9;ciales.</p>
<h2 id="ex&#xE9;cution-dun-programme">Ex&#xE9;cution d&apos;un programme</h2>
<p>Quand un programme d&#xE9;bute, il d&#xE9;marre une fiber principale qui ex&#xE9;cutera votre code principal. De l&#xE0;, d&apos;autres fibers peuvent &#xEA;tre d&#xE9;marr&#xE9;es.
Les composants d&apos;un programme sont:</p>
<ul>
<li>L&apos;ordonnanceur d&apos;ex&#xE9;cution (The Runtime Scheduler), en charge d&apos;ex&#xE9;cuter toutes les fibers au bon moment.</li>
<li>La boucle (The Event Loop), qui est simplement une autre fiber, charg&#xE9;e des t&#xE2;ches asynchrones, comme par exemple les fichiers, sockets, tubes, signaux et timers (comme lors d&apos;un <code>sleep</code>).</li>
<li>Les Channels, pour communiquer des donn&#xE9;es entre fibers. Le Runtime Scheduler va coordonner fibers et channels pour leur communication.</li>
<li>Garbage Collector: pour nettoyer la m&#xE9;moire &quot;plus utilis&#xE9;e&quot;.</li>
</ul>
<h3 id="une-fiber">Une Fiber</h3>
<p>Une fiber est une unit&#xE9; d&apos;ex&#xE9;cution qui est plus l&#xE9;g&#xE8;re qu&apos;un thread. C&apos;est un petit objet qui a sa propre <a href="https://fr.wikipedia.org/wiki/Pile_d%27ex%C3%A9cution" target="_blank">pile d&apos;ex&#xE9;cution</a> de 8MB, ce qui est g&#xE9;n&#xE9;ralement affect&#xE9; &#xE0; un thread de syst&#xE8;me d&apos;exploitation.</p>
<p>Les fibers, &#xE0; l&apos;inverse des threads, sont collaboratives. Les threads sont pre-emptifs:
Le syst&#xE8;me d&apos;exploitation peut interrompre un thread &#xE0; tout moment et d&#xE9;marrer l&apos;ex&#xE9;cution d&apos;un autre.
Une fiber doit explicitement dire au Runtime Scheduler de passer &#xE0; une autre fiber. Par exemple s&apos;il faut attendre apr&#xE8;s une I/O, une fiber va dire &#xE0; l&apos;ordonnanceur  &quot;Ecoute, je dois attendre apr&#xE8;s cette I/O qu&apos;elle soit disponible, continue d&apos;ex&#xE9;cuter d&apos;autres fibers et reviens vers moi
quand cette I/O est pr&#xEA;te&quot;.</p>
<p>L&apos;avantage d&apos;&#xEA;tre collaboratif est que beaucoup de la surcharge li&#xE9;e au changement de contexte (changement entre les threads) n&apos;existe plus.</p>
<p>Une Fiber est beaucoup plus l&#xE9;g&#xE8;re qu&apos;un thread: m&#xEA;me s&apos;il lui est affect&#xE9; 8MB, elle d&#xE9;bute avec une petite pile de 4KB.</p>
<p>Sur une machine 64-bits cela nous laisse d&#xE9;marrer des millions et millions de fibers.
Dans une machine 32-bits on peut seulement lancer 512 fibers, ce qui est peu.
Mais &#xE9;tant donn&#xE9; que les machines 32-bits tendent &#xE0; dispara&#xEE;tre de plus en plus, on parie sur l&apos;avenir, et pour l&apos;instant nous nous focalisons sur les machines 64-bits.</p>
<h3 id="the-runtime-scheduler">The Runtime Scheduler</h3>
<p>Le scheduler a une queue compos&#xE9;e de :</p>
<ul>
<li>Des fibers pr&#xEA;tes &#xE0; &#xEA;tre ex&#xE9;cut&#xE9;es: par exemple quand vous lancez une fiber, elle est pr&#xEA;te &#xE0; &#xEA;tre ex&#xE9;cut&#xE9;e.</li>
<li>La boucle &#xE9;v&#xE9;nementielle: qui est une autre fiber. Quand il n&apos;y a aucune autre fiber &#xE0; ex&#xE9;cuter, la boucle &#xE9;venementielle v&#xE9;rifie s&apos;il y une op&#xE9;ration asynchrone &#xE0; ex&#xE9;cuter,
puis ex&#xE9;cute la fiber en attente de cette op&#xE9;ration. La boucle &#xE9;v&#xE9;nementielle est actuellement impl&#xE9;ment&#xE9;e avec <code>libevent</code>,
qui est une abstraction d&apos;autres m&#xE9;canismes &#xE9;v&#xE9;nementiels comme <code>epoll</code> ou <code>kqueue</code>.</li>
<li>Des fibers qui ont d&#xE9;lib&#xE9;r&#xE9;ment demand&#xE9; &#xE0; attendre: obtenu avec <code>Fiber.yield</code>, qui signifie
&quot;je peux continuer l&apos;ex&#xE9;cution, mais je vais te donner du temps pour ex&#xE9;cuter d&apos;autres fibers si tu le souhaites&quot;.</li>
</ul>
<h3 id="communication-de-donn&#xE9;es">Communication de donn&#xE9;es</h3>
<p>Parce-que pour le moment il n&apos;y a qu&apos;un seul thread ex&#xE9;cutant votre code, acc&#xE9;der et modifier une variable de classe depuis diff&#xE9;rentes fibers se d&#xE9;roulera sans probl&#xE8;me.
N&#xE9;anmoins, d&#xE8;s que plusieurs threads (parall&#xE9;lisme) seront support&#xE9;s par le langage, cela ne fonctionnera plus.
C&apos;est pourquoi le m&#xE9;canisme recommand&#xE9; pour communiquer des donn&#xE9;es est d&apos;utiliser les canaux pour passer les messages entre threads.
En interne, un canal impl&#xE9;mente tous les m&#xE9;canismes de verrou pour &#xE9;viter les courses aux donn&#xE9;es (data races), mais de l&apos;ext&#xE9;rieur vous les utilisez
comme primitives de communication, afin que vous (l&apos;utilisateur) n&apos;ayez &#xE0; utiliser de verrous.</p>
<h2 id="code-exemple">Code exemple</h2>
<h3 id="lancer-une-fiber">Lancer une fiber</h3>
<p>Pour lancer une fiber vous utilisez <code>spawn</code> avec un bloc:</p>
<pre><code class="lang-crystal">spawn <span class="hljs-keyword">do</span>
  <span class="hljs-comment"># ...</span>
  socket.gets
  <span class="hljs-comment"># ...</span>
<span class="hljs-keyword">end</span>

spawn <span class="hljs-keyword">do</span>
  <span class="hljs-comment"># ...</span>
  sleep <span class="hljs-number">5</span>.seconds
  <span class="hljs-comment">#  ...</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Ici nous avons deux fibers: une qui lit depuis une socket et l&apos;autre qui fait un <code>sleep</code>.
Quand la premi&#xE8;re fiber atteint la ligne <code>socket.gets</code>, cette fiber est mise en suspens,
il est signifi&#xE9; &#xE0; la boucle &#xE9;v&#xE9;nementielle de continuer &#xE0; ex&#xE9;cuter cette fiber quand il y aura des donn&#xE9;es dans la socket, et le programme continue avec la deuxi&#xE8;me fiber.
Cette fiber veut dormir pour 5 secondes, alors il est demand&#xE9; &#xE0; la boucle &#xE9;v&#xE9;nementielle de continuer avec cette fiber pour 5 secondes.
S&apos;il n&apos;y a aucune autre fiber &#xE0; ex&#xE9;cuter, la boucle &#xE9;v&#xE9;nementielle va attendre qu&apos;un de ces &#xE9;v&#xE9;nements se produise, sans consommer de temps CPU.</p>
<p>La raison pour laquelle <code>socket.gets</code> et <code>sleep</code> se comportent comme cela est parce-que leur impl&#xE9;mentation communique directement avec le Runtime Scheduler
et la boucle &#xE9;v&#xE9;nementielle, il n&apos;y a rien de magique &#xE0; cela. En g&#xE9;n&#xE9;ral, la librairie standard prend d&#xE9;j&#xE0; soin de faire tout &#xE7;a pour vous &#xE9;viter d&apos;avoir &#xE0; le faire vous-m&#xEA;me.</p>
<p>Remarquez, n&#xE9;anmoins, que les fibers ne sont pas ex&#xE9;cut&#xE9;es imm&#xE9;diatement. Par exemple:</p>
<pre><code class="lang-crystal">spawn <span class="hljs-keyword">do</span>
  loop <span class="hljs-keyword">do</span>
    puts <span class="hljs-string">&quot;Hello!&quot;</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Ex&#xE9;cuter le code pr&#xE9;c&#xE9;dent va produire un affichage et sortir imm&#xE9;diatement.</p>
<p>La raison &#xE0; cela est qu&apos;une fiber n&apos;est pas ex&#xE9;cut&#xE9;e d&#xE8;s qu&apos;elle est lanc&#xE9;e.
Ainsi, la fiber principale, celle qui lance la fiber pr&#xE9;c&#xE9;dente, finit son ex&#xE9;cution et le programme finit.</p>
<p>Un moyen de r&#xE9;soudre cela est d&apos;utiliser un <code>sleep</code>:</p>
<pre><code class="lang-crystal">spawn <span class="hljs-keyword">do</span>
  loop <span class="hljs-keyword">do</span>
    puts <span class="hljs-string">&quot;Hello!&quot;</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

sleep <span class="hljs-number">1</span>.second
</code></pre>
<p>Ce programme va maintenant afficher &quot;Hello!&quot; durant une seconde puis sortir.
C&apos;est parce-que l&apos;appel &#xE0; <code>sleep</code> va planifier l&apos;ex&#xE9;cution de la fiber principale dans une seconde, puis ex&#xE9;cuter l&apos;autre fiber &quot;pr&#xEA;te &#xE0; &#xEA;tre ex&#xE9;cut&#xE9;e&quot;,
qui dans ce cas est la fiber pr&#xE9;c&#xE9;dente.</p>
<p>Une autre mani&#xE8;re de faire:</p>
<pre><code class="lang-crystal">spawn <span class="hljs-keyword">do</span>
  loop <span class="hljs-keyword">do</span>
    puts <span class="hljs-string">&quot;Hello!&quot;</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

Fiber.<span class="hljs-keyword">yield</span>
</code></pre>
<p>Cette fois-ci <code>Fiber.yield</code> va dire &#xE0; l&apos;ordonnanceur d&apos;ex&#xE9;cuter l&apos;autre fiber.
Cela va afficher &quot;Hello!&quot; jusqu&apos;&#xE0; ce que la sortie standard bloque (l&apos;appel syst&#xE8;me va nous dire que nous devons attendre avant que la sortie soit pr&#xEA;te),
puis l&apos;ex&#xE9;cution continue avec la fiber principale et le programme sort. Ici la sortie standard <em>peut</em> ne jamais bloquer et le programme va s&apos;ex&#xE9;cuter ind&#xE9;finiment.</p>
<p>Si nous voulons ex&#xE9;cuter ind&#xE9;finiment la fiber lanc&#xE9;e, nous pouvons utiliser <code>sleep</code> sans argument:</p>
<pre><code class="lang-crystal">spawn <span class="hljs-keyword">do</span>
  loop <span class="hljs-keyword">do</span>
    puts <span class="hljs-string">&quot;Hello!&quot;</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

sleep
</code></pre>
<p>Bien s&#xFB;r le programme pr&#xE9;c&#xE9;dent peut &#xEA;tre &#xE9;crit sans <code>spawn</code> du tout, seulement avec une boucle.
<code>sleep</code> est plus utile lors du lancement de plus d&apos;une fiber.</p>
<h3 id="lancer-un-appel">Lancer un appel</h3>
<p>Vous pouvez aussi lancer un appel en passant un appel de m&#xE9;thode au lieu d&apos;un bloc.
Pour comprendre pourquoi cela serait utile, voyons un exemple:</p>
<pre><code class="lang-crystal">i = <span class="hljs-number">0</span>
<span class="hljs-keyword">while</span> i &lt; <span class="hljs-number">10</span>
  spawn <span class="hljs-keyword">do</span>
    puts(i)
  <span class="hljs-keyword">end</span>
  i += <span class="hljs-number">1</span>
<span class="hljs-keyword">end</span>

Fiber.<span class="hljs-keyword">yield</span>
</code></pre>
<p>Le programme pr&#xE9;c&#xE9;dent affiche &quot;10&quot; dix fois.
Le probl&#xE8;me est qu&apos;il n&apos;y a qu&apos;une variable <code>i</code> &#xE0; laquelle toutes les fibers se r&#xE9;f&#xE9;rent, et quand <code>Fiber.yield</code> est ex&#xE9;cut&#xE9;e sa valeur est 10.</p>
<p>Pour r&#xE9;soudre cela, nous pouvons faire:</p>
<pre><code class="lang-crystal">i = <span class="hljs-number">0</span>
<span class="hljs-keyword">while</span> i &lt; <span class="hljs-number">10</span>
  proc = -&gt;(x : Int32) <span class="hljs-keyword">do</span>
    spawn <span class="hljs-keyword">do</span>
      puts(x)
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
  proc.call(i)
  i += <span class="hljs-number">1</span>
<span class="hljs-keyword">end</span>

Fiber.<span class="hljs-keyword">yield</span>
</code></pre>
<p>Cela fonctionne tel quel car nous cr&#xE9;ons un <a href="http://crystal-lang.org/api/Proc.html" target="_blank">Proc</a> et nous l&apos;invoquons en passant <code>i</code>, alors la valeur est copi&#xE9;e et la fiber lanc&#xE9;e en re&#xE7;oit une copie.</p>
<p>Pour &#xE9;viter tout ce code, la librairie standard fournit une macro <code>spawn</code> qui accepte une expression d&apos;appel et en gros la r&#xE9;&#xE9;crit pour faire l&apos;&#xE9;quivalent de ce qui pr&#xE9;c&#xE9;de. En l&apos;utilisant, on obtient:</p>
<pre><code class="lang-crystal">i = <span class="hljs-number">0</span>
<span class="hljs-keyword">while</span> i &lt; <span class="hljs-number">10</span>
  spawn puts(i)
  i += <span class="hljs-number">1</span>
<span class="hljs-keyword">end</span>

Fiber.<span class="hljs-keyword">yield</span>
</code></pre>
<p>C&apos;est surtout utile avec des variables locales qui changent durant des it&#xE9;rations.
Cela n&apos;arrive pas avec des arguments de bloc. Par exemple, ce qui suit a le fonctionnement attendu:</p>
<pre><code class="lang-crystal"><span class="hljs-number">10</span>.times <span class="hljs-keyword">do</span> |i|
  spawn <span class="hljs-keyword">do</span>
    puts i
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

Fiber.<span class="hljs-keyword">yield</span>
</code></pre>
<h3 id="lancer-une-fiber-et-attendre-la-fin-de-son-ex&#xE9;cution">Lancer une fiber et attendre la fin de son ex&#xE9;cution</h3>
<p>On peut utiliser un channel pour cela:</p>
<pre><code class="lang-crystal">channel = Channel(Nil).new

spawn <span class="hljs-keyword">do</span>
  puts <span class="hljs-string">&quot;Avant envoi&quot;</span>
  channel.send(<span class="hljs-literal">nil</span>)
  puts <span class="hljs-string">&quot;Apr&#xE8;s envoi&quot;</span>
<span class="hljs-keyword">end</span>

puts <span class="hljs-string">&quot;Avant r&#xE9;ception&quot;</span>
channel.receive
puts <span class="hljs-string">&quot;Apr&#xE8;s r&#xE9;ception&quot;</span>
</code></pre>
<p>Ce qui affiche:</p>
<pre><code class="lang-text">Avant r&#xE9;ception
Avant envoi
Apr&#xE8;s r&#xE9;ception
</code></pre>
<p>Tout d&apos;abord, le programme lance une fiber mais ne l&apos;ex&#xE9;cute pas encore. Quand nous invoquons <code>channel.receive</code>, la fiber principale bloque et l&apos;ex&#xE9;cution continue avec la fiber lanc&#xE9;e. Ensuite <code>channel.send(nil)</code> est invoqu&#xE9;e, et alors l&apos;ex&#xE9;cution continue &#xE0; <code>channel.receive</code>, qui &#xE9;tait en attente d&apos;une valeur.
Puis la fiber pincipale continue et s&apos;ach&#xE8;ve, le programme sort donc sans donner &#xE0; l&apos;autre fiber de chance d&apos;afficher &quot;Apr&#xE8;s envoi&quot;.</p>
<p>Dans l&apos;exemple pr&#xE9;c&#xE9;dent nous avons utilis&#xE9; <code>nil</code> simplement pour communiquer que la fiber s&apos;est termin&#xE9;e.
Nous pouvons aussi utiliser les canaux pour communiquer des valeurs entre fibers:</p>
<pre><code class="lang-crystal">channel = Channel(Int32).new

spawn <span class="hljs-keyword">do</span>
  puts <span class="hljs-string">&quot;Avant le premier envoi&quot;</span>
  channel.send(<span class="hljs-number">1</span>)
  puts <span class="hljs-string">&quot;Avant le second envoi&quot;</span>
  channel.send(<span class="hljs-number">2</span>)
<span class="hljs-keyword">end</span>

puts <span class="hljs-string">&quot;Avant la premi&#xE8;re r&#xE9;ception&quot;</span>
value = channel.receive
puts value <span class="hljs-comment"># =&gt; 1</span>

puts <span class="hljs-string">&quot;Avant la deuxi&#xE8;me r&#xE9;ception&quot;</span>
value = channel.receive
puts value <span class="hljs-comment"># =&gt; 2</span>
</code></pre>
<p>Affichage:</p>
<pre><code class="lang-text">Avant la premi&#xE8;re r&#xE9;ception
Avant le premier envoi
1
Avant la deuxi&#xE8;me r&#xE9;ception
Avant le second envoi
2
</code></pre>
<p>Notez que lorsqu&apos;un programme ex&#xE9;cute un <code>receive</code>, cette fiber bloque et l&apos;ex&#xE9;cution se poursuit avec l&apos;autre fiber.
Quand <code>send</code> est ex&#xE9;cut&#xE9;e, l&apos;ex&#xE9;cution continue avec la fiber qui &#xE9;tait en attente sur ce canal.</p>
<p>Ici nous envoyons des valeurs lit&#xE9;rales, mais la fiber lanc&#xE9;e peut calculer cette valeur, par exemple, en lisant un fichier, ou depuis une socket. Quand cette fiber devra attendre apr&#xE8;s une I/O, d&apos;autres fibres pourront continuer &#xE0; ex&#xE9;cuter du code jusqu&apos;&#xE0; ce que cette I/O soit pr&#xEA;te, puis finalement quand cette valeur est pr&#xEA;te et envoy&#xE9;e via le canal, la fiber principale la recevra. Par exemple:</p>
<pre><code class="lang-crystal"><span class="hljs-keyword">require</span> <span class="hljs-string">&quot;socket&quot;</span>

channel = Channel(String).new

spawn <span class="hljs-keyword">do</span>
  server = TCPServer.new(<span class="hljs-string">&quot;0.0.0.0&quot;</span>, <span class="hljs-number">8080</span>)
  socket = server.accept
  <span class="hljs-keyword">while</span> line = socket.gets
    channel.send(line)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

spawn <span class="hljs-keyword">do</span>
  <span class="hljs-keyword">while</span> line = gets
    channel.send(line)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

<span class="hljs-number">3</span>.times <span class="hljs-keyword">do</span>
  puts channel.receive
<span class="hljs-keyword">end</span>
</code></pre>
<p>Le programme pr&#xE9;c&#xE9;dent lance deux fibers. La premi&#xE8;re cr&#xE9;e un TCPServer, accepte une connexion et lit depuis des lignes, et les envoie au canal. Il y a une seconde fiber qui lit des lignes depuis l&apos;entr&#xE9;e standard. La fiber principale
lit les 3 messages qui sont envoy&#xE9;s sur le canal, soit depuis la socket ou stdin, puis le programme sort.
Les appels <code>gets</code> vont bloquer les fibers et dire &#xE0; la boucle &#xE9;v&#xE9;nementielle de continuer &#xE0; partir de l&#xE0; si des donn&#xE9;es arrivent.</p>
<p>De la m&#xEA;me mani&#xE8;re, nous pouvons attendre apr&#xE8;s de multiples fibers d&apos;achever leur ex&#xE9;cution, et de regrouper leurs valeurs:</p>
<pre><code class="lang-crystal">channel = Channel(Int32).new

<span class="hljs-number">10</span>.times <span class="hljs-keyword">do</span> |i|
  spawn <span class="hljs-keyword">do</span>
    channel.send(i * <span class="hljs-number">2</span>)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

sum = <span class="hljs-number">0</span>
<span class="hljs-number">10</span>.times <span class="hljs-keyword">do</span>
  sum += channel.receive
<span class="hljs-keyword">end</span>
puts sum <span class="hljs-comment"># =&gt; 90</span>
</code></pre>
<p>Vous pouvez, bien s&#xFB;r, utiliser <code>receive</code> depuis une fiber qui a &#xE9;t&#xE9; lanc&#xE9;e:</p>
<pre><code class="lang-crystal">channel = Channel(Int32).new

spawn <span class="hljs-keyword">do</span>
  puts <span class="hljs-string">&quot;Avant envoi&quot;</span>
  channel.send(<span class="hljs-number">1</span>)
  puts <span class="hljs-string">&quot;Apr&#xE8;s envoi&quot;</span>
<span class="hljs-keyword">end</span>

spawn <span class="hljs-keyword">do</span>
  puts <span class="hljs-string">&quot;Avant r&#xE9;ception&quot;</span>
  puts channel.receive
  puts <span class="hljs-string">&quot;Apr&#xE8;s r&#xE9;ception&quot;</span>
<span class="hljs-keyword">end</span>

puts <span class="hljs-string">&quot;Avant yield&quot;</span>
Fiber.<span class="hljs-keyword">yield</span>
puts <span class="hljs-string">&quot;Apr&#xE8;s yield&quot;</span>
</code></pre>
<p>Affichage:</p>
<pre><code class="lang-text">Avant yield
Avant envoi
Avant r&#xE9;ception
Before receive
1
Apr&#xE8;s r&#xE9;ception
Apr&#xE8;s envoi
Apr&#xE8;s yield
</code></pre>
<p>Ici <code>channel.send</code> est ex&#xE9;cut&#xE9; en premier, mais &#xE9;tant donn&#xE9; que rien n&apos;est (encore) en attente d&apos;une valeur, l&apos;ex&#xE9;cution se poursuit dans les autres fibers.
La seconde fiber est ex&#xE9;cut&#xE9;e, il y a une valeur dans le canal, elle est obtenue, et l&apos;ex&#xE9;cution continue, d&apos;abord avec la premi&#xE8;re fiber, puis avec la fiber principale,
parce-que <code>Fiber.yield</code> place une fiber en fin de queue d&apos;ex&#xE9;cution.</p>
<h3 id="canaux-tamponn&#xE9;s-buffered-channels">Canaux tamponn&#xE9;s (Buffered Channels)</h3>
<p>Les exemples pr&#xE9;c&#xE9;dents utilisent des canaux non tamponn&#xE9;s (unbuffered channels):
lors de l&apos;envoi d&apos;une valeur, si une fiber est en attente sur ce canal alors l&apos;ex&#xE9;cution continue sur cette fiber.</p>
<p>Avec un canal tamponn&#xE9; (buffered channel), l&apos;appel de <code>send</code> ne basculera pas vers une autre fiber &#xE0; moins que le tampon soit plein:</p>
<pre><code class="lang-crystal"><span class="hljs-comment"># Un canal tamponn&#xE9; de capacit&#xE9; 2</span>
channel = Channel(Int32).new(<span class="hljs-number">2</span>)

spawn <span class="hljs-keyword">do</span>
  puts <span class="hljs-string">&quot;Avant envoi 1&quot;</span>
  channel.send(<span class="hljs-number">1</span>)
  puts <span class="hljs-string">&quot;Avant envoi 2&quot;</span>
  channel.send(<span class="hljs-number">2</span>)
  puts <span class="hljs-string">&quot;Avant envoi 3&quot;</span>
  channel.send(<span class="hljs-number">3</span>)
  puts <span class="hljs-string">&quot;Apr&#xE8;s envoi&quot;</span>
<span class="hljs-keyword">end</span>

<span class="hljs-number">3</span>.times <span class="hljs-keyword">do</span> |i|
  puts channel.receive
<span class="hljs-keyword">end</span>
</code></pre>
<p>Affichage:</p>
<pre><code>Avant envoi 1
Avant envoi 2
Avant envoi 3
1
2
Apr&#xE8;s envoi
3
</code></pre><p>Notez que les deux premiers envois sont ex&#xE9;cut&#xE9;s sans basculer vers une autre fiber.
N&#xE9;anmoins, dans le troisi&#xE8;me envoi le tampon du canal est plein, alors l&apos;ex&#xE9;cution passe &#xE0; la fiber principale.
Ici les deux valeurs sont re&#xE7;ues et le canal est &#xE9;puis&#xE9;. Au troisi&#xE8;me <code>receive</code> la fiber principale bloque et l&apos;ex&#xE9;cution passe &#xE0; l&apos;autre fiber,
qui envoie une autre valeur, finit, etc..</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="performance.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Performance">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Concurrence","level":"1.7.2","depth":2,"previous":{"title":"Performance","level":"1.7.1","depth":2,"path":"guides/performance.md","ref":"guides/performance.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"root":".","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"links":{"contributePrefix":"https://github.com/crystal-french/fr-crystal-book/"},"gitbook":"3.x.x"},"file":{"path":"guides/concurrency.md","mtime":"2017-09-20T14:17:01.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-09-25T17:11:25.680Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

